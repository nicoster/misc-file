<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>
           IJEP-070: AES Support in C6</title>
<style type="text/css">
BODY {
    margin-left: 5%;
    margin-right: 5%;
    font-family: Arial, Helvetica, sans-serif;
    font-size: small;
    }
A:link {
    color: #336699;
    }
A:visited {
    color: #663399;
    }
H1, H2, H3, H4, H5, H6 {
    font-family: Arial, Helvetica, sans-serif;
    color: #336699;
    }
UL {
    list-style: disc outside;
    }
.code {
    font-family: Courier, monotype;
    font-size: smaller;
    }
.body {
    font-family: Arial, Helvetica, sans-serif;
    font-size: smaller;
    }
	</style>
</head>
<body bgcolor="#FFFFFF">
<h1>IJEP-070: AES Support in C6</h1>
<p>This document describes the use of Advanced Encryption Standard (AES) in the WebEx C6 release.</p>
<h2>Author Information</h2>
<h3>Nick Xiao</h3>
<blockquote><p>
      Email: <a href="mailto:Nick.Xiao@webex.com">Nick.Xiao@webex.com</a><br>
      JID: <a href="xmpp:Nick.Xiao@webex.com">Nick.Xiao@webex.com</a></p></blockquote>
<h3>Peter Saint-Andre</h3>
<blockquote><p>
      Email: <a href="mailto:Peter.SaintAndre@webex.com">Peter.SaintAndre@webex.com</a><br>
      JID: <a href="xmpp:Peter.SaintAndre@webex.com">Peter.SaintAndre@webex.com</a></p></blockquote>
<h2>IJEP Information</h2>
<blockquote><p>
            Number: 070<br>
            Status: Experimental<br>
            Type: Standards Track<br>
            JIG: Cisco Systems, Inc.<br>
            Dependencies: RFC 3920, FIPS-197</p></blockquote>
<h2>Legal Notice</h2>
<blockquote><p>Copyright 2000 - 2008 by Cisco Systems, Inc. The information contained in this document is proprietary to Cisco Systems, Inc. This information is considered CISCO CONFIDENTIAL and is not to be disclosed to any outside parties without the express written consent of Cisco Systems, Inc. This document is provided for informational purposes only, and the information herein is subject to change without notice.  Cisco Systems, Inc. does not provide any warranties covering and specifically disclaims any liability in connection with this document.</p></blockquote>
<h2>Revision History</h2>
<blockquote><p><h3>Version 0.1 (2009-08-10)</h3><blockquote><p>Initial version adapted from the document "C6 AES Support in XmppSDK Eng Spec" by Nick Xiao. (nx/psa)
    </p></blockquote></p></blockquote>
<p><hr></p>
<strong>Table of Contents:</strong><br><dl>
<dt>1.  <a href="#sect-id27168">Introduction</a>
</dt>
<dt>2.  <a href="#sect-id27189">Protocol</a>
</dt>
<dl>
<dt>2.1.  <a href="#sect-id27203">Assumptions</a>
</dt>
<dt>2.2.  <a href="#sect-id27242">Order of Events</a>
</dt>
<dt>2.3.  <a href="#sect-id27293">Certificate Exchange</a>
</dt>
<dt>2.4.  <a href="#sect-id27341">Session Establishment</a>
</dt>
<dt>2.5.  <a href="#sect-id27407">Message Exchange</a>
</dt>
</dl>
<dt>3.  <a href="#sect-id27457">Security Considerations</a>
</dt>
<dt>4.  <a href="#sect-id27467">IANA Considerations</a>
</dt>
<dt>5.  <a href="#sect-id27478">XMPP Registrar Considerations</a>
</dt>
<dt>6.  <a href="#sect-id27490">Cisco Registrar Considerations</a>
</dt>
<dt>7.  <a href="#sect-id27503">Schemas</a>
</dt>
</dl>
<p><hr></p>
<h2>1.
     <a name="sect-id27168">Introduction</a>
</h2>
  <p>This specification provides informational documentation about the use of Advanced Encryption Standard (AES) in the WebEx C6 release.</p>
  <p>NOTE: The protocol described herein has not undergone a security review. It is likely to be replaced by whatever technology for end-to-end encryption is developed by the XMPP Working Group at the Internet Engineering Task Force.</p>
<h2>2.
     <a name="sect-id27189">Protocol</a>
</h2>
  <p>This protocol enables two entities (e.g., Alice and Bob) that have obtained certificates from the WebEx Certification Authority to exchange messages that are encrypted using the Advanced Encryption Standard (AES). The process and protocol are discussed below.</p>
  <blockquote>
<h3>2.1 <a name="sect-id27203">Assumptions</a>
</h3>
    <p>This protocol assumes the following:</p>
    <ul>
      <li>The end entities (clients) already possess or can obtain appropriate X.509 certificates from the WebEx Certification Authority (CA). This occurs outside XMPP (via WAPI).</li>
      <li>Certificates issued by other CAs are unsupported.</li>
      <li>Self-signed certificates are unsupported.</li>
      <li>Trust is bootstrapped only via the WebEx CA.</li>
      <li>Certificates issued by the WebEx CA do not include the id-on-xmppAddr field specified in <a href="http://tools.ietf.org/html/rfc3920">RFC 3920</a>  [<a href="#nt-id27265">1</a>]; instead, the WebEx CA sets the Common Name (CN) of the Subject to the JabberID of the end entity.</li>
      <li>All communications occur over encrypted channels between the client and the server.</li>
      <li>There is only one server or server cluster; federated links across servers ("server-to-server" streams) are not supported.</li>
    </ul>
  </blockquote>
  <blockquote>
<h3>2.2 <a name="sect-id27242">Order of Events</a>
</h3>
    <p>The order of events is as follows.</p>
    <blockquote><pre>
Alice                           Bob
  |                              |
  | (1. CERTIFICATE EXCHANGE)    |
  |                              |
  | Offer Certificate            |
  |=============================&gt;|
  |                              |
  | Offer Certificate            |
  |&lt;=============================|
  |                              |
  | (2. SESSION ESTABLISHMENT)   |
  |                              |
  | Request Session Key          |
  |&lt;=============================|
  |                              |
  | Send Session Key             |
  |=============================&gt;|
  |                              |
  | Send Acknowledgement         |
  |&lt;=============================|
  |                              |
  | (3. MESSAGE EXCHANGE)        |
  |                              |
  | Exchange Encrypted Messages  |
  |&lt;============================&gt;|
  |                              |
    </pre></blockquote>
  </blockquote>
  <blockquote>
<h3>2.3 <a name="sect-id27293">Certificate Exchange</a>
</h3>
    <p>Before encrypting their communications, two entities need to exchange certificates. They do so using XMPP &lt;message/&gt; stanzas containing an &lt;x/&gt; child element qualified by the "http://webex.com/connect/imcmd" namespace. For the certificate exchange message, the value of the 'type' attribute SHALL be "121". The XML character data of the &lt;x/&gt; element SHALL be base64-encoded PEM output.</p>
    <p>If Alice wishes to establish an encrypted session with Bob but she does not have his certificate, she first sends her public certificate to Bob.</p>
    <p><strong>Example 1. Alice sends her public certificate</strong></p>
<blockquote><pre>
&lt;message from='alice@example.com/foo' to='bob@example.com/bar'&gt;
  &lt;x xmlns='http://webex.com/connect/imcmd' type='121'&gt;
     BASE64-ENCODED-PEM-DATA
  &lt;/x&gt;
&lt;/message&gt;
    </pre></blockquote>
    <p>Bob MUST take this as a signal that Alice does not have Bob's certificate and therefore he MUST send his certificate to Alice.</p>
    <p><strong>Example 2. Bob sends his public certificate</strong></p>
<blockquote><pre>
&lt;message from='bob@example.com/bar' to='alice@example.com/foo'&gt;
  &lt;x xmlns='http://webex.com/connect/imcmd' type='121'&gt;
     BASE64-ENCODED-PEM-DATA
  &lt;/x&gt;
&lt;/message&gt;
    </pre></blockquote>
  </blockquote>
  <blockquote>
<h3>2.4 <a name="sect-id27341">Session Establishment</a>
</h3>
    <p>In order to establish an encrypted session, Alice now MUST request a session key from Bob. She does so by sending an XMPP &lt;message/&gt; stanza containing an &lt;x/&gt; child element qualified by the "http://webex.com/connect/imcmd" namespace. For the session key request message, the value of the 'type' attribute SHALL be "NNN". The &lt;x/&gt; element MUST be empty (no XML character data or child elements).</p>
    <p><strong>Example 3. Alice requests a session key</strong></p>
<blockquote><pre>
&lt;message from='alice@example.com/foo' to='bob@example.com/bar'&gt;
  &lt;x xmlns='http://webex.com/connect/imcmd' type='NNN'/&gt;
&lt;/message&gt;
    </pre></blockquote>
    <p>Note: The text "NNN" will be replaced by the correct type value as soon as possible.</p>
    <p>When Bob receives the request for a session key, he generates a random session key and encapsulates it along with his certificate in a standard PKCS#7 envelope, which he encodes according to Base 64 and sends to Alice as the XML character data of an &lt;x/&gt; element qualified by the "http://webex.com/connect/imcmd" namespace. For the session key message, the value of the 'type' attribute SHALL be "122".</p>
    <p><strong>Example 4. Bob sends a session key</strong></p>
<blockquote><pre>
&lt;message from='bob@example.com/bar' to='alice@example.com/foo'&gt;
  &lt;x xmlns='http://webex.com/connect/imcmd' type='122'&gt;
     BASE64-ENCODED-PKCS#7-DATA
  &lt;/x&gt;
&lt;/message&gt;
    </pre></blockquote>
    <p>When Alice receives the session key from Bob, she sends an acknowledgement to Bob, which is an XMPP &lt;message/&gt; stanza containing an empty &lt;x/&gt; element qualified by the "http://webex.com/connect/imcmd" namespace, where the value of the 'type' attribute SHALL be "124".</p>
    <p><strong>Example 5. Alice acknowledges receipt of session key</strong></p>
<blockquote><pre>
&lt;message from='alice@example.com/foo' to='bob@example.com/bar'&gt;
  &lt;x xmlns='http://webex.com/connect/imcmd' type='124'/&gt;
&lt;/message&gt;
    </pre></blockquote>
  </blockquote>
  <blockquote>
<h3>2.5 <a name="sect-id27407">Message Exchange</a>
</h3>
    <p>When Alice wishes to send an encrypted message to Bob, she first constructs the cleartext version.</p>
    <p><strong>Example 6. Cleartext message</strong></p>
<blockquote><pre>
&lt;message from='alice@example.com/foo' 
         id='50753D0A-986C-48AB-937A-ABE4E8820A10'
         to='bob@example.com/bar' 
         type='chat'&gt;
  &lt;body&gt;hi Bob, this is a test -- this is only a test!&lt;/body&gt;
  &lt;subject&gt;testing 1-2-3&lt;/subject&gt;
&lt;/message&gt;
    </pre></blockquote>
    <p>Alice would then strip the routing information ("from" and "to" addresses) off the stanza.</p>
    <p><strong>Example 7. Cleartext message stipped of routing information</strong></p>
<blockquote><pre>
&lt;message id='50753D0A-986C-48AB-937A-ABE4E8820A10' type='chat'&gt;
  &lt;body&gt;hi Bob, this is a test -- this is only a test!&lt;/body&gt;
  &lt;subject&gt;testing 1-2-3&lt;/subject&gt;
&lt;/message&gt;
    </pre></blockquote>
    <p>Alice would then convert the stanza into a string of characters without whitespace (not serialize it to a DOM object), encrypt the string using AES, and insert the Base64 output of the AES encryption step as the XML character data of a &lt;data/&gt; element qualified by the "urn:xmpp:tmp:xtls" namespace as described at &lt;http://xmpp.org/extensions/inbox/xtls.html&gt; (note: that document was never published and is not an official XMPP Extension Protocol). The &lt;data/&gt; element is then included as the child element of an IQ-set, as shown below.</p>
    <p><strong>Example 8. Encrypted message</strong></p>
<blockquote><pre>
&lt;iq from='alice@example.com/foo' 
    id='41A4B330-41E7-4E14-98E7-BCD3EC1793B6'
    to='bob@example.com/bar' 
    type='set'&gt;
  &lt;data xmlns='urn:xmpp:tmp:xtls' method='x509'&gt;
    base_64(TLS-Handshake-Messages)
  &lt;/data&gt;
&lt;/iq&gt;
    </pre></blockquote>
  </blockquote>
<h2>3.
     <a name="sect-id27457">Security Considerations</a>
</h2>
  <p>To follow.</p>
<h2>4.
     <a name="sect-id27467">IANA Considerations</a>
</h2>
  <p>This document defines no actions for the IANA.</p>
<h2>5.
     <a name="sect-id27478">XMPP Registrar Considerations</a>
</h2>
  <p>This document defines no actions for the XMPP Registrar.</p>
<h2>6.
     <a name="sect-id27490">Cisco Registrar Considerations</a>
</h2>
  <p>This document defines no actions for the maintainers of the protocols.cisco.com service.</p>
<h2>7.
     <a name="sect-id27503">Schemas</a>
</h2>
  <p>To follow.</p>
<p><hr></p>
<h3>Notes</h3>
<p><a name="nt-id27265">1</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc3920">http://tools.ietf.org/html/rfc3920</a>&gt;.</p>
</body>
</html>
